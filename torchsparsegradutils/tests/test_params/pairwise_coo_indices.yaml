# tests relating to a 2x2x2 volume:

# Labeling of the 2x2x2 cube:

#
#                    z
#                    |
#                    |
#                     ------>x              for (c, z, y, x) shifts
#                   /
#                  /
#                 y
#
#
#          4--------5         12------13         20------21
#         /|       /|        /|       /|        /|       /|
#        / |      / |       / |      / |       / |      / |
#       6--------7  |      14------15  |      22------23  |
#       |  0-----|--1      |  8-----|--9      |  16----|-17
#       | /      | /       | /      | /       | /      | /
#       |/       |/        |/       |/        |/       |/
#       2--------3         10------11         18------19
#
#           c=0               c=1                c=2
#
#
# Cube created by: torch.aranage(3*8).reshape(3, 2, 2, 2)
#
#     (c, z, y, x)
# cube[0, 0, :, :].flatten() = [0, 1, 2, 3]
# cube[0, :, 0, :].flatten() = [0, 1, 4, 5]
# cube[0, :, :, 0].flatten() = [0, 2, 4, 6]

# Diagonal indices

idx0000: &idx0000  # shift = (0, 0, 0, 0)
  - [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]
  - [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]

# Lower triangular indices:
# Indepent channel relation:

idx0001: &idx0001 # (0, 0, 0, 1)
  - [1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23]  # row indices (to voxel)
  - [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22]  # col indices (from voxel)

idx0010: &idx0010  # (0, 0, 1, 0)
  - [2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 22, 23]
  - [0, 1, 4, 5,  8,  9, 12, 13, 16, 17, 20, 21]

idx0100: &idx0100  # (0, 1, 0, 0)
  - [4, 5, 6, 7, 12, 13, 14, 15, 20, 21, 22, 23]
  - [0, 1, 2, 3,  8,  9, 10, 11, 16, 17, 18, 19]

idx0011: &idx0011  # (0, 0, 1, 1)
  - [3, 7, 11, 15, 19, 23]
  - [0, 4,  8, 12, 16, 20]

idx0101: &idx0101  # (0, 1, 0, 1)
  - [5, 7, 13, 15, 21, 23]
  - [0, 2,  8, 10, 16, 18]

idx0110: &idx0110  # (0, 1, 1, 0)
  - [6, 7, 14, 15, 22, 23]
  - [0, 1,  8,  9, 16, 17]

idx001-1: &idx001-1  # (0, 0, 1, -1)
  - [2, 6, 10, 14, 18, 22]
  - [1, 5,  9, 13, 17, 21]

idx010-1: &idx010-1  # (0, 1, 0, -1)
  - [4, 6, 12, 14, 20, 22]
  - [1, 3,  9, 11, 17, 19]

idx01-10: &idx01-10  # (0, 1, -1, 0)
  - [4, 5, 12, 13, 20, 21]
  - [2, 3, 10, 11, 18, 19]

idx0111: &idx0111  # (0, 1, 1, 1)
  - [7, 15, 23]
  - [0, 8, 16]

idx01-11: &idx01-11  # (0, 1, -1, 1)
  - [5, 13, 21]
  - [2, 10, 18]

idx01-1-1: &idx01-1-1  # (0, 1, -1, -1)
  - [4, 12, 20]
  - [3, 11, 19]

idx011-1: &idx011-1  # (0, 1, 1, -1)
  - [6, 14, 22]
  - [1, 9, 17]

# Intra-voxel channel relation:

idx1000: &idx1000  # (1, 0, 0, 0)
  - [8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]
  - [0, 1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15]

idx2000: &idx2000  # (2, 0, 0, 0)
  - [16, 17, 18, 19, 20, 21, 22, 23]
  - [ 0,  1,  2,  3,  4,  5,  6,  7]

# Inter-voxel channel relation:

idx100-1: &idx100-1  # (1, 0, 0, -1)
  - [8, 10, 12, 14, 16, 18, 20, 22]
  - [1,  3,  5,  7,  9, 11, 13, 15]

idx1001: &idx1001  # (1, 0, 0, 1)
  - [9, 11, 13, 15, 17, 19, 21, 23]
  - [0,  2,  4,  6,  8, 10, 12, 14]

idx10-10: &idx10-10  # (1, 0, -1, 0)
  - [8, 9, 12, 13, 16, 17, 20, 21]
  - [2, 3,  6,  7, 10, 11, 14, 15]

idx1010: &idx1010  # (1, 0, 1, 0)
  - [10, 11, 14, 15, 18, 19, 22, 23]
  - [0,   1,  4,  5,  8,  9, 12, 13]

idx1-100: &idx1-100  # (1, -1, 0, 0)
  - [8, 9, 10, 11, 16, 17, 18, 19]
  - [4, 5,  6,  7, 12, 13, 14, 15]

idx1100: &idx1100  # (1, 1, 0, 0)
  - [12, 13, 14, 15, 20, 21, 22, 23]
  - [ 0,  1,  2,  3,  8,  9, 10, 11]

idx200-1: &idx200-1 # (2, 0, 0, -1)
  - [16, 18, 20, 22]
  - [ 1,  3,  5,  7]

idx2001: &idx2001 # (2, 0, 0, 1)
  - [17, 19, 21, 23]
  - [ 0,  2,  4,  6]

idx20-10: &idx20-10  # (2, 0, -1, 0)
  - [16, 17, 20, 21]
  - [ 2,  3,  6,  7]

idx2010: &idx2010 # (2, 0, 1, 0)
  - [18, 19, 22, 23]
  - [ 0,  1,  4,  5]

idx2-100: &idx2-100 # (2, -1, 0, 0)
  - [16, 17, 18, 19]
  - [ 4,  5,  6,  7]

idx2100: &idx2100 # (2, 1, 0, 0)
  - [20, 21, 22, 23]
  - [ 0,  1,  2,  3]

# upper triangular indices:

idx000-1: &idx000-1 # (0, 0, 0, -1)
  - [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22]
  - [1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23]

idx00-10: &idx00-10  # (0, 0, -1, 0)
  - [0, 1, 4, 5,  8,  9, 12, 13, 16, 17, 20, 21]
  - [2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 22, 23]

idx0-100: &idx0-100  # (0, -1, 0, 0)
  - [0, 2, 1, 3,  8, 10,  9, 11, 16, 18, 17, 19]
  - [4, 6, 5, 7, 12, 14, 13, 15, 20, 22, 21, 23]

test_cases:
  - id: "r1_3n_3x2x2x2_indep_lower"
    radius: 1
    vshape: [3, 2, 2, 2]
    diag: false
    upper: false
    channel_relation: "indep"
    expected_indices:
      "(0, 0, 0, 1)": *idx0001
      "(0, 0, 1, 0)": *idx0010
      "(0, 1, 0, 0)": *idx0100

  - id: "r1_3n_3x2x2x2_indep_upper"
    radius: 1
    vshape: [3, 2, 2, 2]
    diag: false
    upper: true
    channel_relation: "indep"
    expected_indices:
      "(0, 0, 0, -1)": *idx000-1
      "(0, 0, -1, 0)": *idx00-10
      "(0, -1, 0, 0)": *idx0-100

  - id: "r1_3n_3x2x2x2_indep_full"
    radius: 1
    vshape: [3, 2, 2, 2]
    diag: false
    upper: null
    channel_relation: "indep"
    expected_indices:
      "(0, 0, 0, -1)": *idx000-1
      "(0, 0, 0, 1)": *idx0001
      "(0, 0, -1, 0)": *idx00-10
      "(0, 0, 1, 0)": *idx0010
      "(0, -1, 0, 0)": *idx0-100
      "(0, 1, 0, 0)": *idx0100

  - id: "r1_3n_3x2x2x2_indep_lower_diag"
    radius: 1
    vshape: [3, 2, 2, 2]
    diag: true
    upper: false
    channel_relation: "indep"
    expected_indices:
      "(0, 0, 0, 0)": *idx0000
      "(0, 0, 0, 1)": *idx0001
      "(0, 0, 1, 0)": *idx0010
      "(0, 1, 0, 0)": *idx0100

  - id: "r2_16n_1x2x2x2_indep_lower"
    radius: 2
    vshape: [3, 2, 2, 2]
    diag: false
    upper: false
    channel_relation: "indep"
    expected_indices:
      "(0, 0, 0, 1)": *idx0001
      "(0, 0, 1, 0)": *idx0010
      "(0, 1, 0, 0)": *idx0100
      "(0, 0, 1, -1)": *idx001-1
      "(0, 0, 1, 1)": *idx0011
      "(0, 1, 0, -1)": *idx010-1
      "(0, 1, 0, 1)": *idx0101
      "(0, 1, -1, 0)": *idx01-10
      "(0, 1, 1, 0)": *idx0110
      "(0, 1, -1, -1)": *idx01-1-1
      "(0, 1, -1, 1)": *idx01-11
      "(0, 1, 1, -1)": *idx011-1
      "(0, 1, 1, 1)": *idx0111
      "(0, 0, 0, 2)": []
      "(0, 0, 2, 0)": []
      "(0, 2, 0, 0)": []

  - id: "r1_3n_3x2x2x2_intra_lower"
    radius: 1
    vshape: [3, 2, 2, 2]
    diag: false
    upper: false
    channel_relation: "intra"
    expected_indices:
      "(0, 0, 0, 1)": *idx0001
      "(0, 0, 1, 0)": *idx0010
      "(0, 1, 0, 0)": *idx0100
      "(1, 0, 0, 0)": *idx1000
      "(2, 0, 0, 0)": *idx2000

  - id: "r1_3n_3x2x2x2_inter_lower"
    radius: 1
    vshape: [3, 2, 2, 2]
    diag: false
    upper: false
    channel_relation: "inter"
    expected_indices:
      "(0, 0, 0, 1)": *idx0001
      "(0, 0, 1, 0)": *idx0010
      "(0, 1, 0, 0)": *idx0100
      "(1, 0, 0, 0)": *idx1000
      "(1, 0, 0, -1)": *idx100-1
      "(1, 0, 0, 1)": *idx1001
      "(1, 0, -1, 0)": *idx10-10
      "(1, 0, 1, 0)": *idx1010
      "(1, -1, 0, 0)": *idx1-100
      "(1, 1, 0, 0)": *idx1100
      "(2, 0, 0, 0)": *idx2000
      "(2, 0, 0, -1)": *idx200-1
      "(2, 0, 0, 1)": *idx2001
      "(2, 0, -1, 0)": *idx20-10
      "(2, 0, 1, 0)": *idx2010
      "(2, -1, 0, 0)": *idx2-100
      "(2, 1, 0, 0)": *idx2100
